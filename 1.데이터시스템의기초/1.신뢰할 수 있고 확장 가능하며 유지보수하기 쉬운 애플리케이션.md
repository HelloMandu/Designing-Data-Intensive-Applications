# 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

**계산 중심(compute-intensive)** -> **데이터 중심(data-intensive)** : CPU 성능 < **데이터의 양**, **복잡도**, **변화 속도**

- Database: 데이터를 찾을 수 있게 저장
- Cache: 읽기 속도 향상을 위해 수행 결과를 기억
- Search Index: 키워드로 데이터 검색, 필터링
- Stream Processing: 메시지 기반 비동기 처리
- Batch Processing: 주기적으로 대량의 누적된 데이터를 분석

![img.png](./image/img.png)

## 3가지 key
- Reliability: 하드웨어나 소프트웨어 결함, 인적오류(human error) 같은 **역경**에 직면하더라도 지속적으로 **올바르게 동작**
- Scalability: 데이터 양, 트래픽 양, 복잡도가 **증가**함에 따라 처리할 수 있는 적절한 방법
- Maintainability: 다양한 사람들이 작업하기 때문에 **생산적으로** 작업

## 1. 신뢰성
- 사용자가 기대한 기능을 수행
- 사용자가 범한 실수나 예상치 못한 소프트웨어 사용법을 허용
- 예상된 부하와 데이터 양에서 필수적인 사용 사례를 충분히 만족
- 허가되지 않은 접근과 오남용을 방지

### 결함과 장애
- 결함: 잘못될 수 있는 일 // **내결함성(fault-tolerant)** 또는 **탄력성(resilient)** 을 가져야 한다
- 장애: 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우

### 하드웨어 결함
- 데이터 양과 계산 요구가 늘어나면서 많은 수의 장비를 사용하게 됬고 이와 비례해 하드웨어 결함율도 증가
- 내결함성과 하드웨어 중복을 추가해 전체 장비의 손실을 견딜 수 있는 시스템으로 옮겨가고 있다

### 소프트웨어 오류
- 잘못된 입력의 경우 서버 인스턴스가 죽는 버그
- CPU, 메모리, 디스크, 네트워크 대역폭처럼 공유 자원을 과도하게 사용하는 일부 프로세스
- 속도가 느려 반응이 없거나 잘못된 응답을 반환하는 서비스
- 한 요소의 작은 결함이 다른 구성 요소의 결함을 야기하는 연쇄장애

### 인적 오류
***사람이 미덥지 않음에도 시스템을 어떻게 신뢰성 있게 만들까?***
- 추상화, API, 인터페이스를 사용해 오류의 가능성을 최소화
- 철저하게 테스트하라. 특히 코너 케이스(corner case)를 다루는데 유용
- 상세하고 명확한 모니터링 대책을 마련

## 2. 확장성
- 대부분의 성능 저하의 원인은 부하 증가   

### 부하 기술하기

##### 부하 매개변수(load parameter)
- 웹 서버의 초당 요청 수
- 데이터베이스 read, write 비율
- 대화방의 동시 활성 사용자
- 캐시 적중율

### 성능 기술하기

- 처리량(throughput): 초당 처리할 수 있는 레코드 수나 일정 크기의 데이터 집합으로 작업을 수행할 때 걸리는 전체 시간
- 응답시간(response time): 클라이언트가 요청을 보내고 응답을 받는 사이의 시간
- 지연 시간(latency): 요청이 처리되길 기다리는 시간으로 서비스를 기다리며 휴지(latent) 상태인 시간

#### 응답 시간 측정
- 단일 숫자가 아닌 측정 가능한 값의 **분포**로 생각
- 가끔 오래 걸리는 **특이 값(outlier)** 이 존재
- **평균**보다는 **백분위(percentile)** 를 사용하는 편이 더 좋다
- 대부분의 응답시간을 알고 싶다면 **중앙값(median)** 이 좋은 지표다
- **꼬리 지연 시간(tail latency)** 은 사용자 경험에 직접 영향을 주기 때문에 중요
- **선두 차단(head-of-line blocking)**: 후속 요청이 빠르게 처리되더라도 이전 요청이 완료되길 기다리는 시간때문에 전체적인 응답 시간이 느려질 수 있다 
- **꼬리 지연 증폭(tail latency amplification)**: 병렬로 호출해도 최종 사용자 요청은 병렬 호줄 중 가장 느린 호출이 완료되길 기다려야 한다

![img.png](image/img2.png)

### 부하 대응 접근 방식
- **용량 확장(scaling up) 수직 확장(vertical scaling)**: 좀 더 강력한 장비로 이동   
- **규모 확장(scaling out) 수평 확장(horizontal scaling)**: 다수의 낮은 사양 장비   
- **비공유(shared-nothing)** 아키텍처: 다수의 장비에 부하를 분산하는 아키텍처 

## 3. 유지보수성
- 운용성(operability): 운영팀이 시스템을 원활하게 운영할 수 있게 만들어라
- 단순성(simplicity): 복잡도를 최대한 제거해 엔지니어가 시스템을 이해하기 쉽게 만들어라
- 발전성(evolvability): 변화에 유연하게 하라. 그래야 요구사항이 변경되었을 때 적용하기 쉽다

### 운용성: 운영의 편리함
- 모니터링
  - 문제가 생기면 복원
  - 장애, 성능 저하 등의 문제 원인 추적
  - 런타임 동작과 시스템 내부의 대한 가시성 제공
- 보안을 포함해 소프트웨어와 플랫폼을 최신 상태로 유지
- 문제가 생길 수 있는 변경 사항을 손상을 입히기 전에 차단
- 발생 가능한 문제를 예측해 해결
- 자동화와 통합을 위한 우수한 지원을 제공
- 개별 장비 의존성을 회피. 장비를 내리더라고 시스템 전체에 영향을 주지 않고 운영 가능해야함
- 좋은 문서와 운영 모델 제공
- 적절한 자기 회복과 필요에 따라 관리자가 시스템 상태를 수동으로 제어

### 단순성: 복잡도 관리
- 추상화는 깔끔하고 직관적인 외간 아래로 많은 세부 구현을 숨길 수 있다.

### 발전성: 변화를 쉽게 만들기
- 변화에 유연한 시스템을 맞추는 방법은 간단, 추상화와 관련이 있다. 이해하기 쉬운 시스템은 수정하기 쉽다.
